using Base.MathConstants

@testset "exponential integral" begin
    @testset "E₁" begin
        @test E₁(0) == Inf
        @test E₁(1) ≅ 0.219383934395520273677163775460121649031047293406908207577
        @test E₁(2) ≅ 0.048900510708061119567239835228049522314492184963023116327
        @test E₁(10) ≅ 4.1569689296853242774028598102781803843462900824195331e-6
        @test E₁(100) ≅ 3.6835977616820321802351926205081189876552201369095676e-46
        @test E₁(500) ≅ 1.422076782253638422098193936057278281607864840846107e-220
        @test E₁(800) ≅ 0.0

        inputs = exp.(-20:0.1:10)
        sympy_results = [19.42278433715962, 19.322784337376394, 19.222784337615966, 19.122784337880734, 19.02278433817335, 18.922784338496736, 18.82278433885413, 18.72278433924912, 18.622784339685648, 18.522784340168087, 18.422784340701263, 18.322784341290514, 18.22278434194174, 18.12278434266145, 18.02278434345686, 17.922784344335916, 17.822784345307426, 17.722784346381115, 17.62278434756772, 17.522784348879124, 17.422784350328445, 17.322784351930196, 17.22278435370041, 17.122784355656787, 17.022784357818928, 16.922784360208457, 16.822784362849298, 16.72278436576788, 16.622784368993408, 16.522784372558174, 16.422784376497845, 16.322784380851854, 16.22278438566378, 16.122784390981778, 16.02278439685908, 15.9227844033545, 15.822784410533048, 15.722784418466574, 15.622784427234473, 15.522784436924503, 15.422784447633639, 15.322784459469066, 15.222784472549236, 15.122784487005058, 15.022784502981212, 14.922784520637595, 14.822784540150915, 14.722784561716468, 14.622784585550088, 14.522784611890314, 14.422784641000764, 14.322784673172787, 14.222784708728371, 14.122784748023365, 14.022784791451052, 13.922784839446066, 13.822784892488759, 13.722784951109999, 13.622785015896484, 13.522785087496624, 13.422785166627014, 13.322785254079614, 13.22278535072968, 13.122785457544516, 13.022785575593161, 12.922785706057084, 12.822785850242006, 12.722786009590976, 12.622786185698807, 12.522786380328046, 12.422786595426597, 12.322786833147234, 12.222787095869135, 12.122787386221697, 12.022787707110858, 11.922788061748168, 11.822788453682934, 11.722788886837751, 11.622789365547748, 11.522789894603982, 11.422790479301383, 11.322791125491747, 11.222791839642303, 11.12279262890043, 11.022793501165198, 10.922794465166412, 10.822795530551975, 10.722796707984457, 10.622798009247786, 10.522799447365191, 10.42280103672952, 10.322802793247288, 10.222804734497844, 10.122806879909312, 10.022809250952998, 9.922811871358254, 9.822814767349943, 9.72281796791086, 9.622821505071744, 9.522825414231814, 9.422829734512947, 9.322834509151155, 9.222839785929189, 9.122845617654615, 9.02285206268818, 8.92285918552768, 8.822867057453237, 8.722875757240391, 8.62288537194812, 8.522895997789721, 8.422907741095162, 8.322920719374606, 8.222935062493638, 8.122950913972003, 8.022968432418745, 7.922987793118102, 7.82300918978195, 7.723032836486275, 7.623058969810944, 7.523087851204097, 7.423119769594673, 7.323155044279064, 7.22319402811058, 7.123237111023398, 7.02328472392596, 6.923337343002434, 6.823395494464799, 6.723459759802626, 6.623530781582367, 6.523609269853401, 6.42369600922396, 6.323791866676501, 6.223897800199283, 6.1240148683187, 6.0241442406255405, 5.924287209397832, 5.824445202433262, 5.7246197972155715, 5.624812736551765, 5.525025945830601, 5.425261552067762, 5.3255219049193, 5.225809599862747, 5.1261275037645175, 5.026478783073171, 4.926866934900832, 4.827295821279563, 4.727769706905961, 4.628293300715657, 4.5288718016598235, 4.429510949088238, 4.330217078177816, 4.230997180881776, 4.131858972912499, 4.032810967310439, 3.9338625551917175, 3.8350240943077325, 3.7363070060905175, 3.637723881896619, 3.5392885991987293, 3.4410164485065415, 3.3429242718241268, 3.2450306134680904, 3.1473558840754343, 3.0499225386185485, 2.9527552692120564, 2.8558812134363936, 2.7593301788087405, 2.6631348838945774, 2.5673312163622644, 2.4719585080265127, 2.3770598265899254, 2.282682283358406, 2.1888773556569636, 2.0957012219856717, 2.0032151071070956, 1.9114856332200545, 1.8205851721219792, 1.7305921917644516, 1.641591588835499, 1.5536749969322847, 1.4669410574993555, 1.381495637990983, 1.2974519786775944, 1.2149307461852896, 1.1340599682961783, 1.0549748208522227, 0.9778172339612489, 0.9027352813396983, 0.8298823138728366, 0.7594157967683303, 0.6914958095854213, 0.6262831706334756, 0.5639371525740695, 0.504612765462193, 0.4484575979169615, 0.3956082275862528, 0.34618623936574333, 0.300293924394601, 0.2580097745012007, 0.21938393439552029, 0.18443382508495607, 0.1531402026676241, 0.12544396087706133, 0.10124401563054918, 0.08039661589653337, 0.06271639726802038, 0.047979423404116976, 0.03592833985705289, 0.026279594676102136, 0.01873246957330826, 0.012979434697842988, 0.00871712131564752, 0.005657041122290276, 0.003535112094510119, 0.0021191140726178706, 0.0012134071920838702, 0.0006605855969159488, 0.00034015430633957324, 0.00016472641349949424, 7.454934526605714e-5, 3.130976062043665e-5, 1.210908610045574e-5, 4.275860766636859e-6, 1.3655518643196761e-6, 3.903218353852035e-7, 9.870632894134583e-8, 2.1803269551751865e-8, 4.147757574661783e-9, 6.690104688552211e-10, 8.99242657318854e-11, 9.882131772436709e-12, 8.693306220424223e-13, 5.980594905814351e-14, 3.1356343973815644e-15, 1.2177117071691607e-16, 3.3940153124998884e-18, 6.556987386595675e-20, 8.44878745962057e-22, 6.958281817792889e-24, 3.494621741922784e-26, 1.016043152861245e-28, 1.6146767591576598e-31, 1.316263182348312e-34, 5.131027792964771e-38, 8.850845917110945e-42, 6.200898062681776e-46, 1.6049744897477247e-50, 1.3821387312935124e-55, 3.527346347225124e-61, 2.3475470880341156e-67, 3.537243078459257e-74, 1.0321861515085605e-81, 4.9081331054612925e-90, 3.1425093238599437e-99, 2.194119577274149e-109, 1.3232967553438042e-120, 5.328592163066933e-133, 1.077722203502411e-146, 7.993181962558972e-162, 1.5355420703790725e-178, 5.2031169882651523e-197, 2.0337894921995622e-217, 5.735534347238297e-240, 6.94730861879321e-265, 2.037480603972396e-292, 8.0e-323, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
        for (x, y) in zip(inputs, sympy_results)
            @test E₁(x) ≅ y
        end
    end

    @testset "En" begin
        @test En(0, 1) ≅ 1/e
        @test En(0, 2) ≅ 1/(2e^2)
        @test En(2, 0) == 1.0
        @test En(3, 0) == 0.5
        @test En(1, -5) ≅ -40.185275355803177455091421793795867095419087399195930434 - 3.1415926535897932384626433832795028841971693993751058209im
        @test En(1, -5+0.01im) ≅ -40.184088057852053166778027787056086608566881324182021075 - 2.8447696994032256009548700952561340708768881138416215357im
        @test En(1, -5+1im) ≅ -29.025158144992710296353782915633718625839577127679530594 + 23.304702810489904370776539518061890789478578493028994502im
        @test En(10im, -10+10im) ≅ 842.196601731195121156507301117535342516890218271788126699 + 481.296521260231635469781278283025739948078026046933687102im
    end
end
